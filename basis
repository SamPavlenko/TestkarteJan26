<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>BÃ¼rgerbeteiligung: Interaktive Karte</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
#map { height: 100vh; }

#formBox {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 1000;
  background: white;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
  font-size: 14px;
}


</style>
</head>

<body>

<div id="formBox">

  Kategorie:
  <select id="category">
    <option value="Hitze">Hitze</option>
    <option value="Starkregen">Starkregen</option>
    <option value="Hochwasser">Hochwasser</option>
    <option value="Versiegelung">Versiegelung</option>
    <option value="Weiteres">Weiteres</option>
  </select>

  <br><br>

  Beschreibung:
  <br>
  <textarea id="comment" rows="3" cols="30"
    placeholder="Beschreibung eingeben..."></textarea>

  <p>Klicke danach auf die Karte um den Punkt zu setzen.</p>

</div>


<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>

// ðŸ”¹ Firebase Config hier einfÃ¼gen
const firebaseConfig = {
  apiKey: "AIzaSyDQ_c0k7ISbheCf2ineoBLvvRaaSOzEJSw",
  authDomain: "testkarte-jan26.firebaseapp.com",
  projectId: "testkarte-jan26",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


// Karte initialisieren
const map = L.map('map').setView([50.908, 6.187], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);


// Marker speichern bei Klick
map.on('click', function(e) {

  const lat = e.latlng.lat;
  const lng = e.latlng.lng;

  const category = document.getElementById("category").value;
  const comment = document.getElementById("comment").value;

  db.collection("marker").add({
    lat: lat,
    lng: lng,
    category: category,
    comment: comment,
    timestamp: new Date()
  });

  const popupText =
    "<b>Kategorie:</b> " + category +
    "<br><b>Info:</b> " + comment;

  L.marker([lat, lng])
    .addTo(map)
    .bindPopup(popupText);

});



// Marker laden
db.collection("marker").get().then(snapshot => {

  snapshot.forEach(doc => {

    const data = doc.data();

    const popupText =
  "<b>Kategorie:</b> " + data.category +
  "<br><b>Info:</b> " + data.comment;

L.marker([data.lat, data.lng])
  .addTo(map)
  .bindPopup(popupText);


  });

});

</script>

</body>
</html>
